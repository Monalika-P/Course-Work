{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Dropdown from DataFrame Columns</title>
            <!-- Bootstrap core CSS -->
        <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
        <!-- Include D3.js -->
        <script src="https://d3js.org/d3.v4.js"></script>
        <!-- Custom styles for this template -->
        <link href="{% static 'css/styles.css' %}" rel="stylesheet">

        <style>
            body {
                margin: 0;
                padding: 0;
                display: flex;
                background-color: #f2f2f2;
               
            }

            body {
                background-image: url('/static/images/bar_background.jpg');
                background-repeat: no-repeat;
                background-attachment: fixed;
                background-size: cover;
              }
              
              
                    .bd-placeholder-img {
                      font-size: 1.125rem;
                      text-anchor: middle;
                      -webkit-user-select: none;
                      -moz-user-select: none;
                      -ms-user-select: none;
                      user-select: none;
                    }
              
                    @media (min-width: 768px) {
                      .bd-placeholder-img-lg {
                        font-size: 3.5rem;
                      }
                    }
    
    </style>
    </head>
    <body>
        {% csrf_token %}
        <div class="bg">
            <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
                <a class="navbar-brand" href="#">Melboune Housing Data</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
                </button>
            </nav>

        <main role="main" class="container"> <div class="starter-template">
        <!-- <div class="half left-half"> -->
        <br> <br> <br> <br>
        <h1>Bar Chart</h1>

        <form method="post" action="{% url 'bar' %}">
            {% csrf_token %}
            <div>
                <label for="columnDropdown">Select a Column:</label>
                <select id="columnDropdown" name="columns">
                    {% for column in df_selected.columns %}
                        <option value="{{ column }}">{{ column }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-check">
                <input type="radio" class="form-check-input" id="hori" name="orientation" value="Horizontal">
                <label class="form-check-label" for="hori">Horizontal</label>
              </div>
              <div class="form-check">
                <input type="radio" class="form-check-input" id="verti" name="orientation" value="Vertical">
                <label class="form-check-label" for="verti">Vertical</label>
              </div>
            <button type="submit", value='click'>Submit</button>
        </form>

        <script>
            document.getElementById('columnDropdown').addEventListener('change', function(event) {
                // Get the selected value
                var selectedValue = this.value;
    
                // Do something with the selected value
                console.log("Selected Value:", selectedValue);
    
                // Prevent the default behavior (closing the dropdown)
                event.preventDefault();
            });
        </script>

        {% if selected_column %}
            {% if orientation == "Vertical"%}
                <p> yes it's vertical </p>
            {% if ctype == "Categorical"%}
                {% if selected_column == "Suburb"%}
                    <div id="bar1"> 
                    <script>
                        var data = {{ selected_column_data|safe }};
                        console.log( typeof data);
                        console.log("The above is datatype")
                        console.log(data);

                        var margin = {top: 100, right: 100, bottom: 100, left: 100},
                            width = 700 - margin.left - margin.right,
                            height = 700 - margin.top - margin.bottom;

                            var x = d3.scaleBand()
                            .range([0, width])
                            .padding(0.1);

                            var y = d3.scaleLinear()
                            .range([height, 0]);
                        
                        // append the svg object to the body of the page
                        var svg = d3.select("#bar1")
                            .append("svg")
                            .attr("width", width + margin.left + margin.right)
                            .attr("height", height + margin.top + margin.bottom)
                            .append("g")
                            .attr("transform",
                                    "translate(" + margin.left + "," + margin.top + ")");

                        
                        function plotbarplot(data){

                            x.domain(data.map(function(d) { return d.Suburb; }));
                            y.domain([0, d3.max(data, function(d) { return d.Propertycount; })]);

                            svg.selectAll(".bar")
                            .data(data)
                            .enter().append("rect")
                            .attr("class", "bar")
                            .attr("x", function(d) { return x(d.Suburb); })
                            .attr("width", x.bandwidth())
                            .attr("y", function(d) { return y(d.Propertycount); })
                            .attr("height", function(d) { return height - y(d.Propertycount); });

                            // Add x axis
                            svg.append("g")
                                .attr("transform", "translate(0," + height + ")")
                                .call(d3.axisBottom(x))
                                .selectAll("text")
                                .style("text-anchor", "end")
                                .attr("dx", "-.8em")
                                .attr("dy", ".15em")
                                .attr("transform", function(d) {
                                    return "rotate(-65)";
                                });

                            // Add y axis
                            svg.append("g")
                                .call(d3.axisLeft(y));
                    
                        }       

                    plotbarplot(data);

                    // set title
                    svg.append("text")
                        .attr("class", "chart-title")
                        .attr("x", -(margin.left)*0.4)
                        .attr("y", -(margin.top)/1.5)
                        .attr("text-anchor", "start")
                        .text("Suburb Distribution")
                    
                    // set X axis label
                    svg.append("text")
                        .attr("class", "chart-label")
                        .attr("x", width/2)
                        .attr("y", height+margin.bottom)
                        .attr("text-anchor", "middle")
                        .text("Suburbs");
                    
                    svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left)
                    .attr("x", 0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text("Property Counts")
                    .attr("font-size", "12px");

                    </script>
                    </div>

                {% else %}
                    <div id="bar2">
                    <script>    
                    var data = {{ selected_column_data|safe }};
                        console.log( typeof data);
                        console.log("The above is datatype")
                        console.log(data);

                        const keysArray = Object.keys(data);
                        console.log(keysArray);

                        var margin = {top: 100, right: 100, bottom: 100, left: 100},
                            width = 700 - margin.left - margin.right,
                            height = 700 - margin.top - margin.bottom;

                            var x = d3.scaleBand()
                            .range([0, width])
                            .padding(0.1);

                            var y = d3.scaleLinear()
                            .range([height, 0]);
                        
                        // append the svg object to the body of the page
                        var svg = d3.select("#bar2")
                            .append("svg")
                            .attr("width", width + margin.left + margin.right)
                            .attr("height", height + margin.top + margin.bottom)
                            .append("g")
                            .attr("transform","translate(" + margin.left + "," + margin.top + ")");

                        function plotbarplot_type(data){
                            
                            x.domain(data.map(function(d) { return d.Type; }));
                            y.domain([0, d3.max(data, function(d) { return d.count; })]);

                            svg.selectAll(".bar")
                            .data(data)
                            .enter().append("rect")
                            .attr("class", "bar")
                            .attr("x", function(d) { return x(d.Type); })
                            .attr("width", x.bandwidth())
                            .attr("y", function(d) { return y(d.count); })
                            .attr("height", function(d) { return height - y(d.count); });

                            // Add x axis
                            svg.append("g")
                                .attr("transform", "translate(0," + height + ")")
                                .call(d3.axisBottom(x))
                                .selectAll("text")
                                .style("text-anchor", "end")
                                .attr("dx", "-.8em")
                                .attr("dy", ".15em")
                                .attr("transform", function(d) {
                                    return "rotate(-65)";
                                });

                            // Add y axis
                            svg.append("g")
                                .call(d3.axisLeft(y));
                    
                        }       

                        function plotbarplot_Method(data){
                            
                            x.domain(data.map(function(d) { return d.Method; }));
                            y.domain([0, d3.max(data, function(d) { return d.count; })]);

                            svg.selectAll(".bar")
                            .data(data)
                            .enter().append("rect")
                            .attr("class", "bar")
                            .attr("x", function(d) { return x(d.Method); })
                            .attr("width", x.bandwidth())
                            .attr("y", function(d) { return y(d.count); })
                            .attr("height", function(d) { return height - y(d.count); });

                            // Add x axis
                            svg.append("g")
                                .attr("transform", "translate(0," + height + ")")
                                .call(d3.axisBottom(x))
                                .selectAll("text")
                                .style("text-anchor", "end")
                                .attr("dx", "-.8em")
                                .attr("dy", ".15em")
                                .attr("transform", function(d) {
                                    return "rotate(-65)";
                                });

                            // Add y axis
                            svg.append("g")
                                .call(d3.axisLeft(y));
                    
                        }       

                        function plotbarplot_Regionname(data){
                            
                            x.domain(data.map(function(d) { return d.Regionname; }));
                            y.domain([0, d3.max(data, function(d) { return d.count; })]);

                            svg.selectAll(".bar")
                            .data(data)
                            .enter().append("rect")
                            .attr("class", "bar")
                            .attr("x", function(d) { return x(d.Regionname); })
                            .attr("width", x.bandwidth())
                            .attr("y", function(d) { return y(d.count); })
                            .attr("height", function(d) { return height - y(d.count); });

                            // Add x axis
                            svg.append("g")
                                .attr("transform", "translate(0," + height + ")")
                                .call(d3.axisBottom(x))
                                .selectAll("text")
                                .style("text-anchor", "end")
                                .attr("dx", "-.8em")
                                .attr("dy", ".15em")
                                .attr("transform", function(d) {
                                    return "rotate(-65)";
                                });

                            // Add y axis
                            svg.append("g")
                                .call(d3.axisLeft(y));
                    
                        }       

                        {% if selected_column == "Regionname"%}
                            plotbarplot_Regionname(data);
                            // set title
                            svg.append("text")
                                .attr("class", "chart-title")
                                .attr("x", -(margin.left)*0.4)
                                .attr("y", -(margin.top)/1.5)
                                .attr("text-anchor", "start")
                                .text("Distribution among the Regions")
                            
                            // set X axis label
                            svg.append("text")
                                .attr("class", "chart-label")
                                .attr("x", width/2)
                                .attr("y", height+margin.bottom)
                                .attr("text-anchor", "middle")
                                .text("Name of the Region");
                                
                            svg.append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", 0 - margin.left)
                            .attr("x", 0 - (height / 2))
                            .attr("dy", "1em")
                            .style("text-anchor", "middle")
                            .text("Counts")
                            .attr("font-size", "12px");
                        {% endif %}
                        
                        {% if selected_column == "Method"%}
                            plotbarplot_Method(data);
                            // set title
                            svg.append("text")
                                .attr("class", "chart-title")
                                .attr("x", -(margin.left)*0.4)
                                .attr("y", -(margin.top)/1.5)
                                .attr("text-anchor", "start")
                                .text("Distribution among the various selling methods")
                            
                            // set X axis label
                            svg.append("text")
                                .attr("class", "chart-label")
                                .attr("x", width/2)
                                .attr("y", height+margin.bottom)
                                .attr("text-anchor", "middle")
                                .text("Selling Method");
                                
                            svg.append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", 0 - margin.left)
                            .attr("x", 0 - (height / 2))
                            .attr("dy", "1em")
                            .style("text-anchor", "middle")
                            .text("Counts")
                            .attr("font-size", "12px");

                            {% endif %}
                        
                            {% if selected_column == "Type"%}

                            plotbarplot_type(data)
                            // set title
                            svg.append("text")
                                .attr("class", "chart-title")
                                .attr("x", -(margin.left)*0.4)
                                .attr("y", -(margin.top)/1.5)
                                .attr("text-anchor", "start")
                                .text("Distribution among the different types of unit")
                            
                            // set X axis label
                            svg.append("text")
                                .attr("class", "chart-label")
                                .attr("x", width/2)
                                .attr("y", height+margin.bottom)
                                .attr("text-anchor", "middle")
                                .text("Type of unit");
                                
                            svg.append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", 0 - margin.left)
                            .attr("x", 0 - (height / 2))
                            .attr("dy", "1em")
                            .style("text-anchor", "middle")
                            .text("Counts")
                            .attr("font-size", "12px");

                        {% endif %}
                        
    
                    </script>
                </div>
                {% endif %}

            {% endif %}

            {% if ctype == "Numeric"%}
                {% if selected_column == 'Price' or selected_column == 'Landsize' or selected_column == 'BuildingArea'%}
                    <div id="h1"> 
                        <script>
                        var data = {{ selected_column_data|safe }};

                        var margin = {top: 100, right: 100, bottom: 100, left: 100},
                        width = 700 - margin.left - margin.right,
                        height = 700 - margin.top - margin.bottom;

                        console.log( typeof data);
                        console.log("The above is datatype")
                            
                            // append the svg object to the body of the page
                            var svg = d3.select("#h1")
                                .append("svg")
                                .attr("width", width + margin.left + margin.right)
                                .attr("height", height + margin.top + margin.bottom)
                                .append("g")
                                .attr("transform",
                                        "translate(" + margin.left + "," + margin.top + ")");
                            
                            // set the dimensions and margins of the graph
                            function plotHistogram_1(data){
                                        
                            var x = d3.scaleLinear()
                            .domain([d3.min(data), d3.max(data)])
                            .range([0, width]);

                            svg.append("g")
                            .attr("transform", "translate(0," + height + ")")
                            .call(d3.axisBottom(x));

                            /*svg.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height+margin.bottom/1.7)
                            .attr("text-anchor", "middle")
                            .text(selected_column);*/

                            // set the parameters for the histogram
                            var histogram = d3.histogram()
                            .value(function(d) { return d; })   
                            .domain(x.domain())  
                            .thresholds(x.ticks(10)); 

                            // And apply this function to data to get the bins
                            var bins = histogram(data);

                            // Y axis: scale and draw:
                            var y = d3.scaleLinear()
                            .range([height, 0]);
                            y.domain([0, d3.max(bins, function(d) { return d.length; })]);   // d3.hist has to be called before the Y axis obviously
                            
                            svg.append("g")
                            .call(d3.axisLeft(y));

                            const GridLine = () => d3.axisLeft().scale(y);
                            svg.append("g").attr("class", "grid")
                            .call(GridLine()
                                .tickSize(-width)
                                .tickFormat("")
                                .ticks(10)
                            );

                            // create a tooltip
                            const tooltip = d3.select("body")
                            .append("div")
                            .attr("class", "tooltip");

                            // append the bar rectangles to the svg element
                            svg.selectAll("rect")
                            .data(bins)
                            .enter()
                            //.join("rect")
                            .append("rect")
                                .attr("x", 1)
                                .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
                                .attr("width", function(d) { return x(d.x1) - x(d.x0) -1 ; })
                                .attr("height", function(d) { return height - y(d.length); })
                                .style("fill", "#69b3a2");

                            
                        }

                        plotHistogram_1(data);

                        {% if selected_column == 'Price' %}

                            // plotHistogram_1(data);

                            svg.append("text")
                            .attr("class", "chart-title")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top)/1.5)
                            .attr("text-anchor", "start")
                            .text("Distribution of the Price ")
                          
                            svg.append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", 0 - margin.left)
                            .attr("x", 0 - (height / 2))
                            .attr("dy", "1em")
                            .style("text-anchor", "middle")
                            .text("Counts")
                            .attr("font-size", "12px");

                            svg.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height+margin.bottom/1.7)
                            .attr("text-anchor", "middle")
                            .text("Price");

                        {% endif %}

                        {% if selected_column == 'Landsize' %}

                            //plotHistogram_1(data);

                            
                            svg.append("text")
                            .attr("class", "chart-title")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top)/1.5)
                            .attr("text-anchor", "start")
                            .text("Distribution of the Landsize ")
            
                            svg.append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", 0 - margin.left)
                            .attr("x", 0 - (height / 2))
                            .attr("dy", "1em")
                            .style("text-anchor", "middle")
                            .text("Counts")
                            .attr("font-size", "12px");

                            svg.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height+margin.bottom/1.7)
                            .attr("text-anchor", "middle")
                            .text("Landsize");

                        {%endif%}

                        {% if selected_column == 'BuildingArea' %}

                        // BuildingArea
                            //plotHistogram_1(data);

                            svg.append("text")
                            .attr("class", "chart-title")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top)/1.5)
                            .attr("text-anchor", "start")
                            .text("Distribution of the Building Area ")
            
                            svg.append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", 0 - margin.left)
                            .attr("x", 0 - (height / 2))
                            .attr("dy", "1em")
                            .style("text-anchor", "middle")
                            .text("Counts")
                            .attr("font-size", "12px");

                            svg.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height+margin.bottom/1.7)
                            .attr("text-anchor", "middle")
                            .text("Building Area");

                        {% endif %}                     

                        </script>
                    
                    </div> 


                {%else%}
                        <div id="h2"> 
                        <script>
                        var data = {{ selected_column_data|safe }};

                        var margin = {top: 100, right: 100, bottom: 100, left: 100},
                        width = 700 - margin.left - margin.right,
                        height = 700 - margin.top - margin.bottom;

                        console.log( typeof data);
                        console.log("The above is datatype")
                            
                            // append the svg object to the body of the page
                            var svg_h2 = d3.select("#h2")
                                .append("svg")
                                .attr("width", width + margin.left + margin.right)
                                .attr("height", height + margin.top + margin.bottom)
                                .append("g")
                                .attr("transform",
                                        "translate(" + margin.left + "," + margin.top + ")");
                            
                            // set the dimensions and margins of the graph
                            function plotHistogram_2(data){
                                        
                            var x = d3.scaleLinear()
                            .domain([d3.min(data), d3.max(data)])
                            .range([0, width]);

                            svg_h2.append("g")
                            .attr("transform", "translate(0," + height + ")")
                            .call(d3.axisBottom(x));

                            // set the parameters for the histogram
                            var histogram = d3.histogram()
                            .value(function(d) { return d; })   
                            .domain(x.domain())  
                            .thresholds(d3.range(Math.floor(x.domain()[0]), Math.ceil(x.domain()[1]) + 1, 1));

                            // And apply this function to data to get the bins
                            const bins = histogram(data);
                            //var bins = d3.histogram()(data);

                            // Y axis: scale and draw:
                            var y = d3.scaleLinear()
                            .range([height, 0]);
                            y.domain([0, d3.max(bins, function(d) { return d.length; })]);   // d3.hist has to be called before the Y axis obviously
                            
                            svg_h2.append("g")
                            .call(d3.axisLeft(y));

                            const GridLine = () => d3.axisLeft().scale(y);
                            svg_h2.append("g").attr("class", "grid")
                            .call(GridLine()
                                .tickSize(-width)
                                .tickFormat("")
                                .ticks(10)
                            );

                            // create a tooltip
                            const tooltip = d3.select("body")
                            .append("div")
                            .attr("class", "tooltip");

                            // append the bar rectangles to the svg element
                            svg_h2.selectAll("rect")
                            .data(bins)
                            .enter()
                            //.join("rect")
                            .append("rect")
                                .attr("x", 1)
                                .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
                                .attr("width", function(d) { return x(d.x1) - x(d.x0) -1 ; })
                                .attr("height", function(d) { return height - y(d.length); })
                                .style("fill", "#69b3a2");

                        }

                        plotHistogram_2(data);

                        {% if selected_column == 'Rooms' %}

                            // set title
                            svg_h2.append("text")
                            .attr("class", "chart-title")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top)/1.5)
                            .attr("text-anchor", "start")
                            .text("Distribution among the number of Rooms");

                            // set X axis label
                            svg_h2.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height + margin.bottom)
                            .attr("text-anchor", "middle")
                            .text("Number of Rooms");

                            // set Y axis label
                            svg_h2.append("text")
                            .attr("class", "chart-label")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top/5))
                            .attr("text-anchor", "start")
                            .text("Counts");

                         {% endif %}

                         {% if selected_column == 'Bathroom' %}

                            // set title
                            svg_h2.append("text")
                            .attr("class", "chart-title")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top)/1.5)
                            .attr("text-anchor", "start")
                            .text("Distribution among the number of Bathrooms");

                            // set X axis label
                            svg_h2.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height + margin.bottom)
                            .attr("text-anchor", "middle")
                            .text("Number of Bathrooms");

                            // set Y axis label
                            svg_h2.append("text")
                            .attr("class", "chart-label")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top/5))
                            .attr("text-anchor", "start")
                            .text("Counts");

                         {% endif %}

                         {% if selected_column == 'Car' %}

                            // set title
                            svg_h2.append("text")
                            .attr("class", "chart-title")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top)/1.5)
                            .attr("text-anchor", "start")
                            .text("Distribution among the number of Car parking spots");

                            // set X axis label
                            svg_h2.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height + margin.bottom)
                            .attr("text-anchor", "middle")
                            .text("Number of Car parking spots");

                            // set Y axis label
                            svg_h2.append("text")
                            .attr("class", "chart-label")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top/5))
                            .attr("text-anchor", "start")
                            .text("Counts");

                         {% endif %}


                    </script>
                </div>

                {%endif%}

            </div>

            {% endif %}

        
        {% endif %} <!-- for the orientation Vertical-->

        {% if orientation == "Horizontal" %} <!-- for the orientation Horizontal-->
            <p> yes it's horizontal </p>
            {% if ctype == "Categorical"%}
                {% if selected_column == "Suburb"%}
                    <div id="bar1"> 
                    <script>
                        var data = {{ selected_column_data|safe }};
                        console.log( typeof data);
                        console.log("The above is datatype")
                        console.log(data);

                        var margin = {top: 100, right: 100, bottom: 100, left: 100},
                            width = 700 - margin.left - margin.right,
                            height = 700 - margin.top - margin.bottom;


                        var x = d3.scaleLinear()
                            .range([0, width])
                            .domain([0, d3.max(data, function(d) { return d.Propertycount; })]);
                        
                        var y = d3.scaleBand()
                            .range([height, 0])
                            .domain(data.map(function(d) { return d.Suburb; }))
                            .padding(0.1);
                        
                        // append the svg object to the body of the page
                        var svg = d3.select("#bar1")
                            .append("svg")
                            .attr("width", width + margin.left + margin.right)
                            .attr("height", height + margin.top + margin.bottom)
                            .append("g")
                            .attr("transform",
                                    "translate(" + margin.left + "," + margin.top + ")");

                        
                        function plotbarplot_horizontal(data){

                            //y.domain(data.map(function(d) { return d.Suburb; }));
                            //x.domain([0, d3.max(data, function(d) { return d.Propertycount; })]);

                            svg.selectAll(".bar")
                            .data(data)
                            .enter().append("rect")
                            .attr("class", "bar")
                            .attr("y", function(d) { return y(d.Suburb); })
                            //.attr("width", function(d) { return height - x(d.Propertycount); })
                            .attr("width", function(d) { return x(d.Propertycount); })
                            .attr("x", 0)
                            .attr("height", y.bandwidth());

                            // Add x axis function(d) { return x(d.Propertycount); }
                            svg.append("g")
                                .attr("transform", "translate(0," + height + ")")
                                .call(d3.axisBottom(x))
                                .selectAll("text")
                                .style("text-anchor", "end")
                                .attr("dx", "-.8em")
                                .attr("dy", ".15em")
                                .attr("transform", function(d) {
                                    return "rotate(-65)";
                                });

                            // Add y axis
                            svg.append("g")
                                .call(d3.axisLeft(y));
                    
                        }       

                    plotbarplot_horizontal(data);

                    // set title
                    svg.append("text")
                        .attr("class", "chart-title")
                        .attr("x", -(margin.left)*0.4)
                        .attr("y", -(margin.top)/1.5)
                        .attr("text-anchor", "start")
                        .text("Suburb Distribution")
                    
                    // set X axis label
                    svg.append("text")
                        .attr("class", "chart-label")
                        .attr("x", width/2)
                        .attr("y", height+margin.bottom)
                        .attr("text-anchor", "middle")
                        .text("Property Counts");
                    
                    svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left)
                    .attr("x", 0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text("Suburb")
                    .attr("font-size", "12px");

                    </script>
                    </div>

                {% else %}
                    <div id="bar2">
                    <script>    
                    var data = {{ selected_column_data|safe }};
                        console.log( typeof data);
                        console.log("The above is datatype")
                        console.log(data);

                        const keysArray = Object.keys(data);
                        console.log(keysArray);
                  
                        var margin = {top: 100, right: 100, bottom: 100, left: 100},
                        width = 700 - margin.left - margin.right,
                        height = 700 - margin.top - margin.bottom;

                        {% if selected_column == "Regionname"%}

                            var x = d3.scaleLinear()
                            .range([0, width])
                            .domain([0, d3.max(data, function(d) { return d.count; })]);
                        
                            var y = d3.scaleBand()
                            .range([height, 0])
                            .domain(data.map(function(d) { return d.Regionname; }))
                            .padding(0.1);
                        
                            // append the svg object to the body of the page
                            var svg = d3.select("#bar2")
                            .append("svg")
                            .attr("width", width + margin.left + margin.right)
                            .attr("height", height + margin.top + margin.bottom)
                            .append("g")
                            .attr("transform",
                                    "translate(" + margin.left + "," + margin.top + ")");
                            
                            function horizontal_plotbarplot_Regionname(data){
                                                        
                                svg.selectAll(".bar")
                                .data(data)
                                .enter().append("rect")
                                .attr("class", "bar")
                                .attr("y", function(d) { return y(d.Regionname); })
                                //.attr("width", function(d) { return height - x(d.Propertycount); })
                                .attr("width", function(d) { return x(d.count); })
                                .attr("x", 0)
                                .attr("height", y.bandwidth());

                                // Add x axis
                                svg.append("g")
                                    .attr("transform", "translate(0," + height + ")")
                                    .call(d3.axisBottom(x))
                                    .selectAll("text")
                                    .style("text-anchor", "end")
                                    .attr("dx", "-.8em")
                                    .attr("dy", ".15em")
                                    .attr("transform", function(d) {
                                        return "rotate(-65)";
                                    });

                                // Add y axis
                                svg.append("g")
                                    .call(d3.axisLeft(y));      
                        
                                 }       

                                horizontal_plotbarplot_Regionname(data);
                                // set title
                                svg.append("text")
                                    .attr("class", "chart-title")
                                    .attr("x", -(margin.left)*0.4)
                                    .attr("y", -(margin.top)/1.5)
                                    .attr("text-anchor", "start")
                                    .text("Distribution among the Regions")
                                
                                // set X axis label
                                svg.append("text")
                                    .attr("class", "chart-label")
                                    .attr("x", width/2)
                                    .attr("y", height+margin.bottom)
                                    .attr("text-anchor", "middle")
                                    .text("Name of the Region");
                                    
                                svg.append("text")
                                .attr("transform", "rotate(-90)")
                                .attr("y", 0 - margin.left)
                                .attr("x", 0 - (height / 2))
                                .attr("dy", "1em")
                                .style("text-anchor", "middle")
                                .text("Counts")
                                .attr("font-size", "12px");
                        {% endif %}
                        
                        {% if selected_column == "Method"%}

                            var x = d3.scaleLinear()
                            .range([0, width])
                            .domain([0, d3.max(data, function(d) { return d.count; })]);
                        
                            var y = d3.scaleBand()
                            .range([height, 0])
                            .domain(data.map(function(d) { return d.Method; }))
                            .padding(0.1);

                            // append the svg object to the body of the page
                            var svg = d3.select("#bar2")
                            .append("svg")
                            .attr("width", width + margin.left + margin.right)
                            .attr("height", height + margin.top + margin.bottom)
                            .append("g")
                            .attr("transform",
                                    "translate(" + margin.left + "," + margin.top + ")");

                            function horizontal_plotbarplot_Method(data){
                                                                                              
                                svg.selectAll(".bar")
                                .data(data)
                                .enter().append("rect")
                                .attr("class", "bar")
                                .attr("y", function(d) { return y(d.Method); })
                                //.attr("width", function(d) { return height - x(d.Propertycount); })
                                .attr("width", function(d) { return x(d.count); })
                                .attr("x", 0)
                                .attr("height", y.bandwidth());

                                // Add x axis
                                svg.append("g")
                                    .attr("transform", "translate(0," + height + ")")
                                    .call(d3.axisBottom(x))
                                    .selectAll("text")
                                    .style("text-anchor", "end")
                                    .attr("dx", "-.8em")
                                    .attr("dy", ".15em")
                                    .attr("transform", function(d) {
                                        return "rotate(-65)";
                                    });

                                // Add y axis
                                svg.append("g")
                                    .call(d3.axisLeft(y));
                            
                            }   
                                horizontal_plotbarplot_Method(data);
                                // set title
                                svg.append("text")
                                    .attr("class", "chart-title")
                                    .attr("x", -(margin.left)*0.4)
                                    .attr("y", -(margin.top)/1.5)
                                    .attr("text-anchor", "start")
                                    .text("Distribution among the various selling methods")
                                
                                // set X axis label
                                svg.append("text")
                                    .attr("class", "chart-label")
                                    .attr("x", width/2)
                                    .attr("y", height+margin.bottom)
                                    .attr("text-anchor", "middle")
                                    .text("Selling Method");
                                    
                                svg.append("text")
                                .attr("transform", "rotate(-90)")
                                .attr("y", 0 - margin.left)
                                .attr("x", 0 - (height / 2))
                                .attr("dy", "1em")
                                .style("text-anchor", "middle")
                                .text("Counts")
                                .attr("font-size", "12px");

                            {% endif %}
                        
                            {% if selected_column == "Type"%}

                            var x = d3.scaleLinear()
                            .range([0, width])
                            .domain([0, d3.max(data, function(d) { return d.count; })]);
                        
                            var y = d3.scaleBand()
                            .range([height, 0])
                            .domain(data.map(function(d) { return d.Type; }))
                            .padding(0.1);
                        
                            // append the svg object to the body of the page
                            var svg = d3.select("#bar2")
                            .append("svg")
                            .attr("width", width + margin.left + margin.right)
                            .attr("height", height + margin.top + margin.bottom)
                            .append("g")
                            .attr("transform",
                            "translate(" + margin.left + "," + margin.top + ")");

                            function horizontal_plotbarplot_type(data){
                              
                                svg.selectAll(".bar")
                                .data(data)
                                .enter().append("rect")
                                .attr("class", "bar")
                                .attr("y", function(d) { return y(d.Type); })
                                //.attr("width", function(d) { return height - x(d.Propertycount); })
                                .attr("width", function(d) { return x(d.count); })
                                .attr("x", 0)
                                .attr("height", y.bandwidth());
    
                                // Add x axis
                                svg.append("g")
                                    .attr("transform", "translate(0," + height + ")")
                                    .call(d3.axisBottom(x))
                                    .selectAll("text")
                                    .style("text-anchor", "end")
                                    .attr("dx", "-.8em")
                                    .attr("dy", ".15em")
                                    .attr("transform", function(d) {
                                        return "rotate(-65)";
                                    });
    
                                // Add y axis
                                svg.append("g")
                                    .call(d3.axisLeft(y));
                        
                            }       

                            horizontal_plotbarplot_type(data)
                            // set title
                            svg.append("text")
                                .attr("class", "chart-title")
                                .attr("x", -(margin.left)*0.4)
                                .attr("y", -(margin.top)/1.5)
                                .attr("text-anchor", "start")
                                .text("Distribution among the different types of unit")
                            
                            // set X axis label
                            svg.append("text")
                                .attr("class", "chart-label")
                                .attr("x", width/2)
                                .attr("y", height+margin.bottom)
                                .attr("text-anchor", "middle")
                                .text("Type of unit");
                                
                            svg.append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", 0 - margin.left)
                            .attr("x", 0 - (height / 2))
                            .attr("dy", "1em")
                            .style("text-anchor", "middle")
                            .text("Counts")
                            .attr("font-size", "12px");

                        {% endif %}
                        
    
                    </script>
                </div>
                {% endif %}

            {% endif %}

            {% if ctype == "Numeric"%}
                {% if selected_column == 'Price' or selected_column == 'Landsize' or selected_column == 'BuildingArea'%}
                    <div id="h1"> 
                        <script>
                        var data = {{ selected_column_data|safe }};

                        var margin = {top: 100, right: 100, bottom: 100, left: 100},
                        width = 700 - margin.left - margin.right,
                        height = 700 - margin.top - margin.bottom;

                        console.log( typeof data);
                        console.log("The above is datatype")
                            
                            // append the svg object to the body of the page
                            var svg = d3.select("#h1")
                                .append("svg")
                                .attr("width", width + margin.left + margin.right)
                                .attr("height", height + margin.top + margin.bottom)
                                .append("g")
                                .attr("transform",
                                        "translate(" + margin.left + "," + margin.top + ")");
                            
                            // set the dimensions and margins of the graph
                            function plotHistogram_1(data){
                                        
                            var x = d3.scaleLinear()
                            .domain([d3.min(data), d3.max(data)])
                            .range([0, width]);

                            svg.append("g")
                            .attr("transform", "translate(0," + height + ")")
                            .call(d3.axisBottom(x));

                            /*svg.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height+margin.bottom/1.7)
                            .attr("text-anchor", "middle")
                            .text(selected_column);*/

                            // set the parameters for the histogram
                            var histogram = d3.histogram()
                            .value(function(d) { return d; })   
                            .domain(x.domain())  
                            .thresholds(x.ticks(10)); 

                            // And apply this function to data to get the bins
                            var bins = histogram(data);

                            // Y axis: scale and draw:
                            var y = d3.scaleLinear()
                            .range([height, 0]);
                            y.domain([0, d3.max(bins, function(d) { return d.length; })]);   // d3.hist has to be called before the Y axis obviously
                            
                            svg.append("g")
                            .call(d3.axisLeft(y));

                            const GridLine = () => d3.axisLeft().scale(y);
                            svg.append("g").attr("class", "grid")
                            .call(GridLine()
                                .tickSize(-width)
                                .tickFormat("")
                                .ticks(10)
                            );

                            // create a tooltip
                            const tooltip = d3.select("body")
                            .append("div")
                            .attr("class", "tooltip");

                            // append the bar rectangles to the svg element
                            svg.selectAll("rect")
                            .data(bins)
                            .enter()
                            //.join("rect")
                            .append("rect")
                                .attr("x", 1)
                                .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
                                .attr("width", function(d) { return x(d.x1) - x(d.x0) -1 ; })
                                .attr("height", function(d) { return height - y(d.length); })
                                .style("fill", "#69b3a2");

                            
                        }

                        plotHistogram_1(data);

                        {% if selected_column == 'Price' %}

                            // plotHistogram_1(data);

                            svg.append("text")
                            .attr("class", "chart-title")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top)/1.5)
                            .attr("text-anchor", "start")
                            .text("Distribution of the Price ")
                          
                            svg.append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", 0 - margin.left)
                            .attr("x", 0 - (height / 2))
                            .attr("dy", "1em")
                            .style("text-anchor", "middle")
                            .text("Counts")
                            .attr("font-size", "12px");

                            svg.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height+margin.bottom/1.7)
                            .attr("text-anchor", "middle")
                            .text("Price");

                        {% endif %}

                        {% if selected_column == 'Landsize' %}

                            //plotHistogram_1(data);

                            
                            svg.append("text")
                            .attr("class", "chart-title")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top)/1.5)
                            .attr("text-anchor", "start")
                            .text("Distribution of the Landsize ")
            
                            svg.append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", 0 - margin.left)
                            .attr("x", 0 - (height / 2))
                            .attr("dy", "1em")
                            .style("text-anchor", "middle")
                            .text("Counts")
                            .attr("font-size", "12px");

                            svg.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height+margin.bottom/1.7)
                            .attr("text-anchor", "middle")
                            .text("Landsize");

                        {%endif%}

                        {% if selected_column == 'BuildingArea' %}

                        // BuildingArea
                            //plotHistogram_1(data);

                            svg.append("text")
                            .attr("class", "chart-title")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top)/1.5)
                            .attr("text-anchor", "start")
                            .text("Distribution of the Building Area ")
            
                            svg.append("text")
                            .attr("transform", "rotate(-90)")
                            .attr("y", 0 - margin.left)
                            .attr("x", 0 - (height / 2))
                            .attr("dy", "1em")
                            .style("text-anchor", "middle")
                            .text("Counts")
                            .attr("font-size", "12px");

                            svg.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height+margin.bottom/1.7)
                            .attr("text-anchor", "middle")
                            .text("Building Area");

                        {% endif %}                     

                        </script>
                    
                    </div> 


                {%else%}
                        <div id="h2"> 
                        <script>
                        var data = {{ selected_column_data|safe }};

                        var margin = {top: 100, right: 100, bottom: 100, left: 100},
                        width = 700 - margin.left - margin.right,
                        height = 700 - margin.top - margin.bottom;

                        console.log( typeof data);
                        console.log("The above is datatype")
                            
                            // append the svg object to the body of the page
                            var svg_h2 = d3.select("#h2")
                                .append("svg")
                                .attr("width", width + margin.left + margin.right)
                                .attr("height", height + margin.top + margin.bottom)
                                .append("g")
                                .attr("transform",
                                        "translate(" + margin.left + "," + margin.top + ")");
                            
                            // set the dimensions and margins of the graph
                            function plotHistogram_2(data){
                                        
                            var x = d3.scaleLinear()
                            .domain([d3.min(data), d3.max(data)])
                            .range([0, width]);

                            svg_h2.append("g")
                            .attr("transform", "translate(0," + height + ")")
                            .call(d3.axisBottom(x));

                            // set the parameters for the histogram
                            var histogram = d3.histogram()
                            .value(function(d) { return d; })   
                            .domain(x.domain())  
                            .thresholds(d3.range(Math.floor(x.domain()[0]), Math.ceil(x.domain()[1]) + 1, 1));

                            // And apply this function to data to get the bins
                            const bins = histogram(data);
                            //var bins = d3.histogram()(data);

                            // Y axis: scale and draw:
                            var y = d3.scaleLinear()
                            .range([height, 0]);
                            y.domain([0, d3.max(bins, function(d) { return d.length; })]);   // d3.hist has to be called before the Y axis obviously
                            
                            svg_h2.append("g")
                            .call(d3.axisLeft(y));

                            const GridLine = () => d3.axisLeft().scale(y);
                            svg_h2.append("g").attr("class", "grid")
                            .call(GridLine()
                                .tickSize(-width)
                                .tickFormat("")
                                .ticks(10)
                            );

                            // create a tooltip
                            const tooltip = d3.select("body")
                            .append("div")
                            .attr("class", "tooltip");

                            // append the bar rectangles to the svg element
                            svg_h2.selectAll("rect")
                            .data(bins)
                            .enter()
                            //.join("rect")
                            .append("rect")
                                .attr("x", 1)
                                .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
                                .attr("width", function(d) { return x(d.x1) - x(d.x0) -1 ; })
                                .attr("height", function(d) { return height - y(d.length); })
                                .style("fill", "#69b3a2");

                        }

                        plotHistogram_2(data);

                        {% if selected_column == 'Rooms' %}

                            // set title
                            svg_h2.append("text")
                            .attr("class", "chart-title")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top)/1.5)
                            .attr("text-anchor", "start")
                            .text("Distribution among the number of Rooms");

                            // set X axis label
                            svg_h2.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height + margin.bottom)
                            .attr("text-anchor", "middle")
                            .text("Number of Rooms");

                            // set Y axis label
                            svg_h2.append("text")
                            .attr("class", "chart-label")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top/5))
                            .attr("text-anchor", "start")
                            .text("Counts");

                         {% endif %}

                         {% if selected_column == 'Bathroom' %}

                            // set title
                            svg_h2.append("text")
                            .attr("class", "chart-title")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top)/1.5)
                            .attr("text-anchor", "start")
                            .text("Distribution among the number of Bathrooms");

                            // set X axis label
                            svg_h2.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height + margin.bottom)
                            .attr("text-anchor", "middle")
                            .text("Number of Bathrooms");

                            // set Y axis label
                            svg_h2.append("text")
                            .attr("class", "chart-label")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top/5))
                            .attr("text-anchor", "start")
                            .text("Counts");

                         {% endif %}

                         {% if selected_column == 'Car' %}

                            // set title
                            svg_h2.append("text")
                            .attr("class", "chart-title")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top)/1.5)
                            .attr("text-anchor", "start")
                            .text("Distribution among the number of Car parking spots");

                            // set X axis label
                            svg_h2.append("text")
                            .attr("class", "chart-label")
                            .attr("x", width/2)
                            .attr("y", height + margin.bottom)
                            .attr("text-anchor", "middle")
                            .text("Number of Car parking spots");

                            // set Y axis label
                            svg_h2.append("text")
                            .attr("class", "chart-label")
                            .attr("x", -(margin.left)*0.4)
                            .attr("y", -(margin.top/5))
                            .attr("text-anchor", "start")
                            .text("Counts");

                         {% endif %}


                    </script>
                </div>

                {%endif%}

            </div>

            {% endif %}

        {% endif %} <!-- for the orientation Horizontal-->
        
        {% endif %} <!-- for the first most if cond-->
   
    
    </div> </main> 
    </body>
    <script src="bootstrap/javascript.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script> window.jQuery || document.write('<script src="/docs/4.4/assets/js/vendor/jquery.slim.min.js"><\/script>')</script><script src="/docs/4.4/dist/js/bootstrap.bundle.min.js" integrity="sha384-6khuMg9gaYr5AxOqhkVIODVIvm9ynTT5J4V1cfthmT+emCG6yVmEZsRHdxlotUnm" crossorigin="anonymous"></script></body>
</html>